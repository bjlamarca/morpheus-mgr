from PySide6.QtWidgets import (QApplication, QMainWindow, QWidget, QVBoxLayout, QHBoxLayout, QTabWidget, QLabel,
                               QPushButton, QTableWidget, QAbstractItemView, QTableWidgetItem, QComboBox, QDialog,
                               QLineEdit, QCheckBox, QFrame, QMessageBox, QGroupBox, QFormLayout, QGridLayout,
                               QHeaderView)
from PySide6.QtGui import Qt
from ui.utilities import get_icon_obj
from ui.widgets import ChoiceBox, LogViewer, StatusBar



class HueBridgeWindow(QMainWindow):
    def __init__(self):
        super().__init__()
    
        #### Bridge List 
        bridge_list_grpbox = QGroupBox('Bridges')
        bridge_btn_layout = QGridLayout()
        btn_add_bridge = QPushButton('Add Bridge')
        btn_add_bridge.clicked.connect(self.add_bridge)
        btn_add_bridge.setIcon(get_icon_obj('plus-circle'))
        btn_edit_bridge = QPushButton('Edit Bridge')
        btn_edit_bridge.clicked.connect(self.edit_bridge)
        btn_edit_bridge.setIcon(get_icon_obj('pencil'))
        btn_del_bridge = QPushButton('Delete Bridge')
        btn_del_bridge.clicked.connect(self.del_bridge)
        btn_del_bridge.setIcon(get_icon_obj('cross-circle'))
        bridge_btn_layout.addWidget(btn_add_bridge, 0, 0, 1, 1)
        bridge_btn_layout.addWidget(btn_edit_bridge, 0, 1, 1, 1)
        bridge_btn_layout.addWidget(btn_del_bridge, 0, 2, 1, 1)
        
        bridge_choicebox_layout = QHBoxLayout()
        self.bridge_choicebox = ChoiceBox()
        bridge_choicebox_layout.addWidget(self.bridge_choicebox)
        bridge_choicebox_layout.addStretch()
        
        bridge_tbl_layout = QHBoxLayout()
        self.bridge_table = QTableWidget()
        self.bridge_table.doubleClicked.connect(self.edit_bridge)
        hub_tbl_header = self.bridge_table.horizontalHeader()
        hub_tbl_header.setSectionResizeMode(QHeaderView.ResizeMode.Interactive) 
        hub_tbl_header.setStretchLastSection(True) 
        self.bridge_table.setMinimumWidth(375)
        bridge_tbl_layout.addWidget(self.bridge_table)
        bridge_tbl_layout.addStretch()

        bridge_list_layout = QVBoxLayout()
        bridge_list_layout.addLayout(bridge_btn_layout)
        bridge_list_layout.addLayout(bridge_choicebox_layout)
        bridge_list_layout.addLayout(bridge_tbl_layout)
        bridge_list_grpbox.setLayout(bridge_list_layout)

        #### Log viewer
        log_layout = QHBoxLayout()
        self.log_viewer = LogViewer()
        log_layout.addWidget(self.log_viewer)
        log_layout.addStretch()

        #### Status bar
        self.status_bar = StatusBar()
        
        #### Main window
        grid_layout = QGridLayout()
        grid_layout.addWidget(bridge_list_grpbox, 0, 0, 1, 2)
        grid_layout.addLayout(log_layout, 0, 2, 1, 2)
        
        V_layout = QVBoxLayout()
        V_layout.addLayout(grid_layout)
        V_layout.addStretch()
        V_layout.addWidget(self.status_bar)
        H_layout = QHBoxLayout()
        H_layout.addLayout(V_layout)
        H_layout.addStretch()
        self.setWindowTitle("Devices")
        main_widget = QWidget()
        self.setCentralWidget(main_widget)
        self.main_layout = QVBoxLayout(main_widget)
        self.main_layout.addLayout(H_layout)
        self.setLayout(self.main_layout)
        
        self.bridge_choicebox.hide()
        self.status_bar.set_msg({'type': 'message','status': 'info', 'message': 'Ready'}, 7)